---
layout: ../layouts/MainLayout.astro
title: "dots"
source: ""
scope: "public"
type: "source"
created: "2024-06-17T11:49Z"
modified: "2024-07-19T06:50Z"
---

import NoteMeta from "../components/NoteMeta.astro"

<NoteMeta name="dots-the-concept" source="" scope="public" type="main" created="2024-06-17T11:50Z" modified="2024-07-16T14:46Z" />

Dts are going to be the dotfiles and provisioning scripts for my devices (2 currently).

I need to work on the machine I'm writing this on, so I can't reinstall the system on it now. What I can do is either dual-boot or make a VM.

Somehow I forgot that I can just make a VM until like 2 days ago. I have 32 gigs of RAM, so I can even leave it running in the background.

So yeah, I'll make a [nixos](/nixos) [virtual-machine](/virtual-machine) and write my dotfiles on that.

---

<NoteMeta name="dots-empty-machine" source="" scope="public" type="main" created="2024-06-17T21:12Z" modified="2024-07-01T17:54Z" />

I've set up the machine and installed neovim on it. This note will be uploaded after the config, but the dates in the frontmatter are correct.

~~Tomorrow~~ On 2024-06-18 I'll start writing the actual dotfiles.

The machine set up using [quickemu](/quickemu), it's in `~/vms/nixos-unstable-gnome.conf` although it doesn't use gnome. I'll probably rename it later.

---

<NoteMeta name="dots-flake" source="" scope="public" type="main" created="2024-06-18T12:11Z" modified="2024-07-01T17:54Z" />

I've set up a flake in it and installed [home-manager](/home-manager). That works well. What doesn't is [sway](/sway), I can't yet figure out how to start it on [quickemu](/quickemu).

---

<NoteMeta name="2024-06-24-hardware-dots" source="" scope="public" type="main" created="2024-06-24T15:20Z" modified="2024-06-24T15:23Z" />

I now use [dots](/dots) on my primary machine! You can check out the repo [on GitHub](https://github.com/janElikan/dots). If you have any input, please create an issue there!

---

<NoteMeta name="2024-06-27-gnome" source="" scope="public" type="main" created="2024-06-27T16:27Z" modified="2024-07-10T15:49Z" />

I'm creating a branch inside [dots](/dots) for gnome. I need to figure out how to get screen capture working on wayland, so until then...

---

<NoteMeta name="website-prototype-one-done" source="" scope="public" type="main" created="2024-07-10T15:50Z" modified="2024-07-10T15:50Z" />

It's in a usable state! I have added it

---

<NoteMeta name="dots-rules" source="" scope="public" type="main" created="2024-07-16T06:11Z" modified="2024-07-16T14:45Z" />

Requirements for each machine:
- all *perephirals must be wired*
- *no remote access* except for the server
- *no closed-source services* that have *full access to hardware* (e.g. google assistant)
  - exception: phone vendor's kernel
- all devices can be *set up* either fully or semi-*automatically* using the [dots repo](https://github.com/janElikan/dots) (i.e. no snowflakes)
- the *OS* has to be able to *heal itself* to a point, no system reinstalls

Data:
- the vault is as public/transparent as possible
- all important data is stored in one directory
- that directory is synced across all devices
- compressed, encrypted and backed up weekly

Physical machines:
- workstation <span class="sitelen-pona">ilo&sona suli</span>
- mobile computer <span class="sitelen-pona">ilo&sona tawa</span>
- server, optional

Virtual machines:
- can follow the requirements if they are trusted
- are considered temporary, disposable if they don't

Containers are not treated as machines and do not have to follow these.

---

<NoteMeta name="dots-tawa-init" source="" scope="public" type="main" created="2024-07-18T04:46Z" modified="2024-07-18T07:56Z" />

Currently, the device that will become <span class="sitelen-pona">ilo&sona tawa</span> is running LineageOS 21 with no root and no gapps. I'll create a separate user on it to test the concept, then probably format it.

I'll start with the terminal, which it must have as it's a general-purpose computer. There's a project called [nix-on-droid](/nix-on-droid), which I'll try now.

Then I want to see if it can manage system-level APKs.

P.S. No, it can only run as a primary user, so I have to do everything on the current account \*sigh\*.

---

<NoteMeta name="nix-on-droid" source="https://github.com/nix-community/nix-on-droid" scope="public" type="main" created="2024-07-18T04:52Z" modified="2024-07-18T05:00Z" />

*Nix-on-Droid* lets you run the *nix package manager* on android. It also supports home manager!

Under the hood, it uses termux *proot*, which is a userland hack that partially replaces chroot without requiring sudo.

You can *install* it from [f-droid](https://f-droid.org/packages/com.termux.nix/). Then it can either be configured like this:
```nix
{ pkgs, ... }:

{
  # in ~/.config/nixpkgs/nix-on-droid.nix
  environment.packages = [ pkgs.vim ];
  system.stateVersion = "24.05";
}
```
```shell
> nix-on-droid switch
> nix-on-droid rollback
```

or with a flake:
```nix
{
  description = "Minimal example of Nix-on-Droid system config.";

  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs/nixos-24.05";

    nix-on-droid = {
      url = "github:nix-community/nix-on-droid/release-24.05";
      inputs.nixpkgs.follows = "nixpkgs";
    };
  };

  outputs = { self, nixpkgs, nix-on-droid }: {

    nixOnDroidConfigurations.default = nix-on-droid.lib.nixOnDroidConfiguration {
      system = "aarch64-linux";
      modules = [ ./nix-on-droid.nix ];
    };

  };
}
```
```shell
> nix-on-droid switch --impure --flake <path>#device # first time
> nix-on-droid switch --flake <path>#device
```

---

<NoteMeta name="integrating-with-nix-on-droid" source="" scope="public" type="main" created="2024-07-18T05:55Z" modified="2024-07-18T05:56Z" />

[nix-on-droid](/nix-on-droid) has generated a flake, I'll now merge it with my main `dots` repo. First, I'll have to refactor the config of THIS device though.

---

<NoteMeta name="dots-tawa-128-minutes-in" source="" scope="public" type="main" created="2024-07-18T07:47Z" modified="2024-07-18T07:55Z" />

When I started refactoring *dots* for *nix-on-droid*, I thought half of the `configuration.nix` will be shared between both devices. Well no, it won't. I'm not even entirely sure that the package versions will be the same, as <span class="sitelen-pona">ilo&sona tawa</span> is currently running nixpkgs 24.05.

I also have to switch away from the catppuccin nix module, as it uses a quite few things that simply do not exist on non-nixos systems.

One thing I'm extremely happy about, though! It *doesn't feel like a phone*, like an <span class="sitelen-pona">ilo&toki</span>, it's a <span class="sitelen-pona">ilo&sona tawa</span>, a *mobile computer*.

---

<NoteMeta name="drawing-the-hardware" source="" scope="public" type="main" created="2024-07-18T10:48Z" modified="2024-07-18T13:01Z" />

I'll probably never upload photos, but I want to add pics of my hardware setup to the dots repo (and here, obviously). Also, my site doesn't currently support images, that's a perfect opportunity to fix it!

Update: I'm done with the computer in that pic, gonna get back to the rest later.

---

<NoteMeta name="device-naming" source="" scope="public" type="main" created="2024-07-19T06:40Z" modified="2024-07-19T06:50Z" />

My *naming scheme* before february 2024 was non-existant. My computer was running pop os, so it was called `ryzen5-pop`. My phone used whatever name the manufacturer gave it.

Then I switched to `LLSSSRRRI`:

| hostname  | Location | System       | Role       | Index | type         |
| --------- | -------- | ------------ | ---------- | ----- | ------------ |
| honixdev0 | *ho*me   | *nix*os      | *dev*box   | 0     | workstation  |
| hodebsrv0 | *ho*me   | *deb*ian     | *s*e*rv*er | 0     | raspberry pi |
| molincli0 | *mo*bile | *lin*eage os | *cli*ent   | 0     | phone        |

But that's a bit extra, considering that at most I will have 3 devices (as stated in [dots-rules](/dots-rules)).

So currently I renamed
- `honixdev0` to `suli`, as in `big computer`
- `molincli0` to `tawa`, as in `portable computer`

Also more on `molincli0`, it was planned to be an ssh client, but now it's a standalone machine, so it'd be wrong to call it `cli0` anymore.